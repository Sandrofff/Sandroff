<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Python for Vincenty&#039;s formula ellipsoidal distance WGS-84</title><link rel="pingback" href="https://www.johndcook.com/blog/xmlrpc.php"> <!--[if lt IE 9]> <script src="https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/js/html5shiv.js"></script> <![endif]--><link href='//fonts.googleapis.com/css?family=Open Sans' rel='stylesheet' type='text/css'><link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'><meta name="description"  content="Python code for finding the distance between two points on earth, taking into account the equatorial bulge (oblate spheroid shape)." /><meta name="keywords"  content="geodesy,python" /><link rel="canonical" href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/" /><link rel='dns-prefetch' href='//www.johndcook.com' /><link rel='dns-prefetch' href='//ajax.googleapis.com' /><link rel='dns-prefetch' href='//fonts.googleapis.com' /><link rel='dns-prefetch' href='//s.w.org' /><link rel="alternate" type="application/rss+xml" title="John D. Cook &raquo; Feed" href="https://www.johndcook.com/blog/feed/" /><link rel="alternate" type="application/rss+xml" title="John D. Cook &raquo; Comments Feed" href="https://www.johndcook.com/blog/comments/feed/" /><link rel="alternate" type="application/rss+xml" title="John D. Cook &raquo; Ellipsoid distance on Earth Comments Feed" href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/feed/" /> <script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.johndcook.com\/blog\/wp-includes\/js\/wp-emoji-release.min.js"}};!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script> <style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='contact-form-7-css'  href='https://www.johndcook.com/blog/wp-content/plugins/contact-form-7/includes/css/styles.css' type='text/css' media='all' /><link rel='stylesheet' id='latest-posts-widget-css'  href='https://www.johndcook.com/blog/wp-content/plugins/latest-posts-widget/latest-posts.css' type='text/css' media='all' /><link rel='stylesheet' id='pc_google_analytics-frontend-css'  href='https://www.johndcook.com/blog/wp-content/plugins/pc-google-analytics/assets/css/frontend.css' type='text/css' media='all' /><link rel='stylesheet' id='google-fonts-css'  href='https://fonts.googleapis.com/css?family=Montserrat%3A300%2C400%2C400i%2C700%2C700i' type='text/css' media='all' /><link rel='stylesheet' id='themealley_business-style-css'  href='https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/style.css' type='text/css' media='all' /> <!--[if lt IE 9]><link rel='stylesheet' href='https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/css/fixed.css' type='text/css' media='all' /> <![endif]--><!--[if lt IE 8]><link rel='stylesheet' href='https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/css/ie.css' type='text/css' media='all' /> <![endif]--><link rel='https://api.w.org/' href='https://www.johndcook.com/blog/wp-json/' /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.johndcook.com/blog/xmlrpc.php?rsd" /><link rel='prev' title='Sequence alignment' href='https://www.johndcook.com/blog/2018/11/24/sequence-alignment/' /><link rel='next' title='All possible scales' href='https://www.johndcook.com/blog/2018/11/26/all-possible-scales/' /><link rel="alternate" type="application/json+oembed" href="https://www.johndcook.com/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.johndcook.com%2Fblog%2F2018%2F11%2F24%2Fspheroid-distance%2F" /><link rel="alternate" type="text/xml+oembed" href="https://www.johndcook.com/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.johndcook.com%2Fblog%2F2018%2F11%2F24%2Fspheroid-distance%2F&#038;format=xml" /> <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-3581291-2','auto');ga('send','pageview');</script> <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script><script type="text/javascript">/*<![CDATA[*/(function(url){if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){return;}
var addEvent=function(evt,handler){if(window.addEventListener){document.addEventListener(evt,handler,false);}else if(window.attachEvent){document.attachEvent('on'+evt,handler);}};var removeEvent=function(evt,handler){if(window.removeEventListener){document.removeEventListener(evt,handler,false);}else if(window.detachEvent){document.detachEvent('on'+evt,handler);}};var evts='contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');var logHuman=function(){if(window.wfLogHumanRan){return;}
window.wfLogHumanRan=true;var wfscr=document.createElement('script');wfscr.type='text/javascript';wfscr.async=true;wfscr.src=url+'&r='+Math.random();(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);for(var i=0;i<evts.length;i++){removeEvent(evts[i],logHuman);}};for(var i=0;i<evts.length;i++){addEvent(evts[i],logHuman);}})('//www.johndcook.com/blog/?wordfence_lh=1&hid=246ACB582574422C625D494FA1D9FA01');/*]]>*/</script> <style  type="text/css">body,button,input,select,textarea,.site-description{font-family:'Open Sans'}h1,h2,h3,h4,h5,h6,
.site-slider-slider-one-text-heading,
.site-slider-slider-one-text-button a,
.site-slider-slider-one-text-button span,
.site-slider-slider-oneplus-text-heading,
.site-slider-slider-oneplus-text-button a,
.site-slider-slider-oneplus-text-button span,
.site-slider-slider-video-one-text-heading,
.site-slider-slider-video-one-text-button a,
.site-slider-slider-video-one-text-button span,
.site-slider-slider-two-text-heading,
.site-slider-slider-two-text-button a,
.site-slider-slider-two-text-button span,
.cycle-slideshow-captiony h2,
.cycle-slideshow-captiony h2 a,
.hero-heading,
.hero-pitch-text h2,
.hero-pitch-button p a,
.hero-pitch-button p span,
.hero-pane-mobile-title p,
.biz0ne-welcome h1,
.biz0ne-products-services-name,
.biz0neplus-welcome h1,
.biz0neplus-products-services-name,
.biztwo-welcome h1,
.biztwo-products-services-name,
.biztwo-portfolio-heading,
.bizthree-welcome h1,
.bizthree-products-services-name,
.bizfour-welcome h1,
.bizfour-products-services-name,
.bizfive-welcome h1,
.bizfive-products h2,
.bizfive-services h2,
.bizfive-products-services-name,
.bizfive-blog h2,
.bizfive-news-name,
.bizfive-testimonial h2,
.bizsix-welcome h1,
.bizsix-welcome-cta-container span,
.bizsix-quote-text p,
.bizseven-welcome h1,
.bizseven-work-intro h1,
.bizseven-welcome h1,
.bizeight-welcome h2,
.bizeight-products-services-name,
.bizeight-clients h2,
.bizeight-blog h2,
.bizeight-news-name,
.biznine-products-item-title,
.biznine-quote-text,
.biznine-about-inner h1,
.portfolio-one-item-desc-link a, .portfolio-one-item-desc-link a:visited,
.portfolio-two-item-desc-link a, .portfolio-two-item-desc-link a:visited,
.portfolio-three-item-desc-link a, .portfolio-three-item-desc-link a:visited,
.portfolio-four-item-desc-link a, .portfolio-four-item-desc-link a:visited,
.bizseven-work-intro h1,
.bizseven-welcome h1,
.fractionslider .claim,
.fractionslider .middle span,
.fractionslider .button,
.sl-slider blockquote cite a,
.sl-slider blockquote cite
span{font-family:'Oswald'}.site-header{}.site-title a, .site-title a:visited, .site-title a:active{}.site-description{}.site-slider{}.main-navigation-inner{}.main-navigation{}.nav-border-top{}.main-navigation-inner .main-navigation li:hover,
.main-navigation li:hover{}.main-navigation-inner .main-navigation a,
.main-navigation
a{}.main-navigation-inner .main-navigation ul ul,
.main-navigation ul
ul{}.main-navigation-inner .main-navigation ul ul a,
.main-navigation ul ul
a{}.main-navigation-inner .main-navigation ul ul li:hover,
.main-navigation ul ul li:hover{}.main-navigation-inner .main-navigation li.current_page_item,
.main-navigation-inner .main-navigation li.current-menu-item,
.main-navigation li.current_page_item,
.main-navigation li.current-menu-item{}.site-slider-slider-one-text-button
a{}.site-slider-slider-one-text-button
span{}.site-main{}.biz0ne-welcome
h1{color:}.biz0ne-welcome, .biz0ne-welcome ul li, .biz0ne-welcome ul li:before{color:}.biz0ne-welcome a, .biz0ne-welcome ul li
a{color:}.biz0ne-products-services-name, .biz0ne-products-services-name
a{color:}.biz0ne-products-services-description, .biz0ne-products-services-description ul li, .biz0ne-products-services-description ul li:before{color:}.biz0ne-products-services-description a, .biz0ne-products-services-description ul li
a{color:}.biz0ne-quote{}.biz0ne-quote-text{color:}.biz0ne-quote-name
span{background-color:;color:}.post .entry-title,.entry-meta,.entry-meta-bottom-item{color:}.entry-meta-bottom{}.entry-meta-bottom-item
a{background:}.post .entry-title, .post .entry-title
a{color:}.page .entry-title{color:}.page-content,.entry-content,.entry-summary,.entry-meta{color:}.page-content a,
.entry-content a,
.entry-summary a,
.entry-meta-bottom-item a,
.entry-meta
a{color:}blockquote{}mark, ins, pre, .more-link, .page-links
a{background:}.wp-caption{}.site-content .gallery a
img{}.paging-navigation .nav-previous, .paging-navigation .nav-next,.post-navigation,.comments-area{background-color:;color:}.post-navigation .nav-previous a, .post-navigation .nav-next a,
.comment-navigation .nav-previous a, .comment-navigation .nav-next a,
.comment-author cite, .comment-author time, .comment-author .edit-link a,
.comments-area a,
.paging-navigation .nav-previous a, .paging-navigation .nav-next
a{color:}.comment-form-comment textarea, .comment-form input[type="text"], .comment-form input[type="email"], .comment-form input[type="password"], .comment-form input[type="search"]{background-color:;color:}.form-submit
#submit{background-color:;color:}.comment-body .reply
a{background-color:;color:}.widget-area,.fourohfour-widget-container{}.widget{color:}.widget
a{color:}.widget
h1{color:}.widget ul
li{}.widget ul li
a{color:}.search-field, .widget
select{background: !important;color: !important}.search-submit{background: !important;color: !important}.footer-client-logos-container{}.footer-social{}.footer-five-map{}.footer-six-map-container, .footer-six-address, .footer-six-address a,.footer-six-email:before,.footer-six-phone:before,.footer-six-fax:before,.footer-six-skype:before{color:}.site-footer{}.site-footer .widget
h1{color:}.site-footer .widget, .site-info p, .site-info-three
p{color:}.site-footer .widget a, .site-footer .widget ul li a, .site-info a, .site-info h3 a, .site-info p a, .site-info-three a, .site-info-three h3 a, .site-info-three p
a{color:}.site-footer .search-field, .footer-search .search-field{color:}.site-footer .search-submit, .footer-search .search-submit{color: !important}.site-footer .widget select, .footer-widget-three .widget select, .footer-widget-two .widget
select{background:;color:}.portfolio-page-title{color:}.portfolio-description{color:}.portfolio-two-item-odd,.portfolio-two-item-even,.portfolio-three-item-odd,.portfolio-three-item-even,.portfolio-four-item-odd,.portfolio-four-item-even{}.portfolio-two-item-image,.portfolio-three-item-image,.portfolio-four-item-image{}.portfolio-one-item-desc-title, .portfolio-two-item-desc-title, .portfolio-three-item-desc-title, .portfolio-four-item-desc-title,
.portfolio-one-item-desc-title a, .portfolio-two-item-desc-title a, .portfolio-three-item-desc-title a, .portfolio-four-item-desc-title
a{color:}.portfolio-one-item-desc-desc, .portfolio-one-item-desc-desc ul li, .portfolio-one-item-desc-desc ul li:before, .portfolio-two-item-desc-desc, .portfolio-two-item-desc-desc ul li, .portfolio-two-item-desc-desc ul li:before, .portfolio-three-item-desc-desc, .portfolio-three-item-desc-desc ul li, .portfolio-three-item-desc-desc ul li:before, .portfolio-four-item-desc-desc, .portfolio-four-item-desc-desc ul li, .portfolio-four-item-desc-desc ul li:before{color:}.portfolio-two-item-desc-link,.portfolio-three-item-desc-link,.portfolio-four-item-desc-link{}.portfolio-one-item-desc-link a, .portfolio-two-item-desc-link a, .portfolio-three-item-desc-link a, .portfolio-four-item-desc-link a,
.portfolio-one-item-desc-link a:visited, .portfolio-two-item-desc-link a:visited, .portfolio-three-item-desc-link a:visited, .portfolio-four-item-desc-link a:visited{color:}.wpcf7-text,.wpcf7-number,.wpcf7-date,.wpcf7-textarea,.wpcf7-select,.wpcf7-quiz,.wpcf7-captchar,.wpcf7-file{}.wpcf7-submit{}@media screen
and (min-width : 600px)
and (max-width : 900px){}</style><style type="text/css">.broken_link,a.broken_link{text-decoration:line-through}</style><style type="text/css" id="custom-background-css">body.custom-background{background-image:url("https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/skins/images/alexandria/page_bg.png");background-position:left top;background-size:auto;background-repeat:repeat;background-attachment:scroll}</style></head><body class="post-template-default single single-post postid-37220 single-format-standard custom-background group-blog"><div id="wrapper-one"><div id="wrapper-two"><div id="wrapper-three"><div id="page" class="hfeed site"><div class="header-social"><div class="responsive-container"></div></div> <header id="masthead" class="site-header" role="banner"><div class="responsive-container"><div class="site-branding"> <a href="https://www.johndcook.com/blog/"> <img src="https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/images/Logo.svg" alt="John D. Cook" /> </a></div> <nav id="site-navigation" class="main-navigation" role="navigation"><div class="screen-reader-text skip-link"><a href="#content" title="Skip to content">Skip to content</a></div><div class="menu-main_header-container"><ul id="main-nav" class="menu"><li id="menu-item-36773" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-36773"><a href="https://www.johndcook.com/blog/data-privacy/">PRIVACY</a><ul class="sub-menu"><li id="menu-item-36924" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36924"><a href="https://www.johndcook.com/blog/expert-hipaa-deidentification/">HIPAA</a></li><li id="menu-item-36941" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36941"><a href="https://www.johndcook.com/blog/gdpr/">GDPR</a></li><li id="menu-item-36937" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36937"><a href="https://www.johndcook.com/blog/data-mining-and-privacy/">DATA MINING</a></li><li id="menu-item-36978" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36978"><a href="https://www.johndcook.com/blog/data-privacy/">DATA PRIVACY</a></li></ul></li><li id="menu-item-22639" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-22639"><a href="https://www.johndcook.com/blog/applied-math/">MATH</a><ul class="sub-menu"><li id="menu-item-36931" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36931"><a href="https://www.johndcook.com/blog/applied-computation/">COMPUTATION</a></li><li id="menu-item-37296" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37296"><a href="https://www.johndcook.com/blog/explaining-probability-to-a-jury/">EXPERT TESTIMONY</a></li><li id="menu-item-37298" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37298"><a href="https://www.johndcook.com/blog/applied-probability/">PROBABILITY</a></li><li id="menu-item-36932" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36932"><a href="https://www.johndcook.com/blog/partial-differential-equations/">DIFFERENTIAL EQUATIONS</a></li><li id="menu-item-37299" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37299"><a href="https://www.johndcook.com/blog/applied-kalman-filtering/">FILTERING &#038; TRACKING</a></li><li id="menu-item-37007" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37007"><a href="https://www.johndcook.com/blog/complex-networks/">NETWORKS</a></li><li id="menu-item-36974" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36974"><a href="https://www.johndcook.com/blog/applied-math/">SEE ALL &#8230;</a></li></ul></li><li id="menu-item-22638" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-22638"><a href="https://www.johndcook.com/blog/applied-statistics/">STATS</a><ul class="sub-menu"><li id="menu-item-37293" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37293"><a href="https://www.johndcook.com/blog/expert-testimony/">EXPERT TESTIMONY</a></li><li id="menu-item-36927" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36927"><a href="https://www.johndcook.com/blog/randomization/">RANDOMIZATION</a></li><li id="menu-item-36926" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36926"><a href="https://www.johndcook.com/blog/bayesian-consulting/">BAYESIAN ANALYSIS</a></li><li id="menu-item-36928" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36928"><a href="https://www.johndcook.com/blog/digital-signal-processing-and-time-series-analysis/">DSP / TIME SERIES</a></li><li id="menu-item-37008" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37008"><a href="https://www.johndcook.com/blog/applied-medical-devices/">MEDICAL DEVICES</a></li><li id="menu-item-37301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-37301"><a href="https://www.johndcook.com/blog/applied-engineering-statistics/">ENGINEERING STATISTICS</a></li><li id="menu-item-36975" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36975"><a href="https://www.johndcook.com/blog/applied-statistics/">SEE ALL &#8230;</a></li></ul></li><li id="menu-item-22607" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-has-children menu-item-22607"><a href="https://www.johndcook.com/blog/">BLOG</a><ul class="sub-menu"><li id="menu-item-36977" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36977"><a href="https://www.johndcook.com/blog/writing/">WRITING</a></li><li id="menu-item-22605" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22605"><a href="https://www.johndcook.com/blog/notes/">TECH NOTES</a></li><li id="menu-item-27267" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-27267"><a href="https://www.johndcook.com/blog/newsletter/">NEWSLETTER</a></li></ul></li><li id="menu-item-20447" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-20447"><a href="https://www.johndcook.com/blog/clients-new/">CLIENTS</a><ul class="sub-menu"><li id="menu-item-18295" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18295"><a href="https://www.johndcook.com/blog/endorsements/">ENDORSEMENTS</a></li><li id="menu-item-36923" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36923"><a href="https://www.johndcook.com/blog/team/">TEAM</a></li><li id="menu-item-36976" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36976"><a href="https://www.johndcook.com/blog/clients-new/">CLIENTS</a></li></ul></li></ul></div>                </nav><div class="header-contacts"><div class="header-phone"><a href="tel:8324228646">(832) 422-8646</a></div> <a href="https://www.johndcook.com/blog/contact/" class="btn btn-primary">Contact</a></div></div> </header><div id="inner-container"><div id="main" class="site-main"><div class="responsive-container"><div class="content-container"><div id="primary" class="content-area"><div id="content" class="site-content" role="main"> <article id="post-37220" class="post-37220 post type-post status-publish format-standard hentry category-math category-python tag-geodesy tag-python"> <header class="entry-header"><h1 class="entry-title">Ellipsoid distance on Earth</h1><div class="entry-meta"> <span class="posted-on">Posted on <a href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/" title="18:58" rel="bookmark"><time class="entry-date published" datetime="2018-11-24T18:58:02+00:00">24 November 2018</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://www.johndcook.com/blog/author/john/" title="View all posts by John">John</a></span></span></div> </header><div class="entry-content"><p><img class="alignnone size-medium" src="https://www.johndcook.com/globe.jpeg" alt="globe" width="440" height="280" /></p><p>To first approximation, Earth is a sphere. But it bulges at the equator, and to second approximation, Earth is an <a href="https://www.johndcook.com/blog/2009/03/02/what-is-the-shape-of-the-earth/">oblate spheroid</a>. Earth is not exactly an oblate spheroid either, but the error in the oblate spheroid model is about 100x smaller than the error in the spherical model.</p><p>Finding the distance between two points on a sphere is fairly simple. Here&#8217;s a <a href="https://www.johndcook.com/lat_long_distance.html">calculator</a> to compute the distance, and here&#8217;s a <a href="https://www.johndcook.com/lat_long_details.html">derivation</a> of the formula used in the calculator.</p><p>Finding the distance between two points on an ellipsoid is much more complicated. (A spheroid is a kind of ellipsoid.) <a href="https://en.wikipedia.org/wiki/Vincenty%27s_formulae">Wikipedia</a> gives a description of <strong>Vincenty&#8217;s algorithm</strong> for finding the distance between two points on Earth using an oblate spheroid model (specifically <strong>WGS-84</strong>). I&#8217;ll include a <strong>Python</strong> implementation below.</p><h2>Comparison with spherical distance</h2><p>How much difference does it make when you calculate difference on an oblate spheroid rather than a sphere? To address that question I looked at the coordinates of several cities around the world using the <code>CityData</code> function in Mathematica. Latitude is in degrees north of the equator and longitude is in degrees east of the prime meridian.</p><pre>    |--------------+--------+---------|
    | City         |    Lat |    Long |
    |--------------+--------+---------|
    | Houston      |  29.78 |  -95.39 |
    | Caracas      |  10.54 |  -66.93 |
    | London       |  51.50 |   -0.12 |
    | Tokyo        |  35.67 |  139.77 |
    | Delhi        |  28.67 |   77.21 |
    | Honolulu     |  21.31 | -157.83 |
    | Sao Paulo    | -23.53 |  -46.63 |
    | New York     |  40.66 |  -73.94 |
    | Los Angeles  |  34.02 | -118.41 |
    | Cape Town    | -33.93 |   18.46 |
    | Sydney       | -33.87 |  151.21 |
    | Tromsø       |  69.66 |   18.94 |
    | Singapore    |   1.30 |  103.85 |
    |--------------+--------+---------|
</pre><p>Here are the error extremes.</p><p>The spherical model underestimates the distance from London to Tokyo by 12.88 km, and it overestimates the distance from London to Cape Town by 45.40 km.</p><p>The relative error is most negative for London to New York (-0.157%) and most positive for Tokyo to Sidney (0.545%).</p><p><strong>Update</strong>: The comparison above used the same radius for both the spherical and ellipsoidal models. As suggested in the comments, a better comparison would use the <em>mean</em> radius (average of equatorial and polar radii) in the spherical model rather than the equatorial radius.</p><p>With that change the most negative absolute error is between Tokyo and New York at -30,038 m. The most negative relative error is between London and New York at -0.324%.</p><p>The largest positive error, absolute and relative, is between Tokyo and Sydney. The absolute error is 29,289 m and the relative error is 0.376%.</p><h2>Python implementation</h2><p>The code below is a direct implementation of the equations in the Wikipedia article.</p><p>Note that longitude and latitude below are assumed to be in radians. You can convert from degrees to radians with SciPy&#8217;s <code>deg2rad</code> function.</p><pre>from scipy import sin, cos, tan, arctan, arctan2, arccos, pi

def spherical_distance(lat1, long1, lat2, long2):
    phi1 = 0.5*pi - lat1
    phi2 = 0.5*pi - lat2
    r = 0.5*(6378137 + 6356752) # mean radius in meters
    t = sin(phi1)*sin(phi2)*cos(long1-long2) + cos(phi1)*cos(phi2)
    return r * arccos(t)

def ellipsoidal_distance(lat1, long1, lat2, long2):

    a = 6378137.0 # equatorial radius in meters 
    f = 1/298.257223563 # ellipsoid flattening 
    b = (1 - f)*a 
    tolerance = 1e-11 # to stop iteration

    phi1, phi2 = lat1, lat2
    U1 = arctan((1-f)*tan(phi1))
    U2 = arctan((1-f)*tan(phi2))
    L1, L2 = long1, long2
    L = L2 - L1

    lambda_old = L + 0

    while True:
    
        t = (cos(U2)*sin(lambda_old))**2
        t += (cos(U1)*sin(U2) - sin(U1)*cos(U2)*cos(lambda_old))**2
        sin_sigma = t**0.5
        cos_sigma = sin(U1)*sin(U2) + cos(U1)*cos(U2)*cos(lambda_old)
        sigma = arctan2(sin_sigma, cos_sigma) 
    
        sin_alpha = cos(U1)*cos(U2)*sin(lambda_old) / sin_sigma
        cos_sq_alpha = 1 - sin_alpha**2
        cos_2sigma_m = cos_sigma - 2*sin(U1)*sin(U2)/cos_sq_alpha
        C = f*cos_sq_alpha*(4 + f*(4-3*cos_sq_alpha))/16
    
        t = sigma + C*sin_sigma*(cos_2sigma_m + C*cos_sigma*(-1 + 2*cos_2sigma_m**2))
        lambda_new = L + (1 - C)*f*sin_alpha*t
        if abs(lambda_new - lambda_old) &lt;= tolerance:
            break
        else:
            lambda_old = lambda_new

    u2 = cos_sq_alpha*((a**2 - b**2)/b**2)
    A = 1 + (u2/16384)*(4096 + u2*(-768+u2*(320 - 175*u2)))
    B = (u2/1024)*(256 + u2*(-128 + u2*(74 - 47*u2)))
    t = cos_2sigma_m + 0.25*B*(cos_sigma*(-1 + 2*cos_2sigma_m**2))
    t -= (B/6)*cos_2sigma_m*(-3 + 4*sin_sigma**2)*(-3 + 4*cos_2sigma_m**2)
    delta_sigma = B * sin_sigma * t
    s = b*A*(sigma - delta_sigma)

    return s
</pre></div><footer class="entry-meta-bottom"><div class="entry-meta-bottom-item">Categories : <a href="https://www.johndcook.com/blog/category/math/" rel="category tag">Math</a> <a href="https://www.johndcook.com/blog/category/python/" rel="category tag">Python</a></div><div class="entry-meta-bottom-item">Tags : <a href="https://www.johndcook.com/blog/tag/geodesy/" rel="tag">Geodesy</a> <a href="https://www.johndcook.com/blog/tag/python/" rel="tag">Python</a></div><div class="entry-meta-bottom-item">Bookmark the <a href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/" title="Permalink to Ellipsoid distance on Earth" rel="bookmark">permalink</a></div> </footer> </article><nav role="navigation" id="nav-below" class="post-navigation"><h1 class="screen-reader-text">Post navigation</h1><div class="nav-previous"><span class="meta-nav">Previous Post</span><a href="https://www.johndcook.com/blog/2018/11/24/sequence-alignment/" rel="prev">Sequence alignment</a></div><div class="nav-next"><span class="meta-nav">Next Post</span><a href="https://www.johndcook.com/blog/2018/11/26/all-possible-scales/" rel="next">All possible scales</a></div> </nav><div id="comments" class="comments-area"><h2 class="comments-title"> 4 thoughts on &ldquo;<span>Ellipsoid distance on Earth</span>&rdquo;</h2><ol class="comment-list"><li id="comment-955224" class="comment even thread-even depth-1"> <article id="div-comment-955224" class="comment-body"><div class="comment-author vcard"><div class="comment-author-image"></div><div class="comment-author-name"><div> <cite class="fn">BobC</cite></div><div> <a href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/#comment-955224"> <time datetime="2018-11-24T21:09:55+00:00"> 24 November 2018 at 21:09                                </time> </a></div><div></div><div></div></div></div><div class="comment-content"><p>Reminds me of avionics work I did using the WMM (World Magnetic Model) to estimate the local magnetic heading based on GPS.  We needed +/- 0.1 degree resolution with +/- .25 degree accuracy.  The model itself was far too complex to run in real-time on our embedded host processor (<a href="https://www.ngdc.noaa.gov/geomag/WMM/back.shtml" rel="nofollow">https://www.ngdc.noaa.gov/geomag/WMM/back.shtml</a>), but stacked LUTs and a fancy interpolator did the job just fine.</p><p>The testing and certification took many times longer than the algorithm development.  The FAA inspector wanted to see simulated performance flying near the poles and the SAA (South Atlantic Anomaly).  Many, many times.  From every approach angle.  Then in CW and CCW orbits.  Ugh.</p><p>We also had tons of flight data from our electronic compass product, so we also replayed those.  Numerous differences were seen, *all* of which were traced to errors in the electronic compass.  (Mainly hard and soft iron errors.)</p></div><div class="reply"></div> </article></li><li id="comment-955243" class="comment odd alt thread-odd thread-alt depth-1"> <article id="div-comment-955243" class="comment-body"><div class="comment-author vcard"><div class="comment-author-image"></div><div class="comment-author-name"><div> <cite class="fn">Dr. Drang</cite></div><div> <a href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/#comment-955243"> <time datetime="2018-11-25T00:08:15+00:00"> 25 November 2018 at 00:08                                </time> </a></div><div></div><div></div></div></div><div class="comment-content"><p>Wouldn’t it be fairer to the spherical estimate to use the mean radius rather than the equatorial? This should bring the underestimates and the overestimates closer to one another.</p></div><div class="reply"></div> </article></li><li id="comment-955274" class="comment even thread-even depth-1"> <article id="div-comment-955274" class="comment-body"><div class="comment-author vcard"><div class="comment-author-image"></div><div class="comment-author-name"><div> <cite class="fn">Jakub Narębski</cite></div><div> <a href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/#comment-955274"> <time datetime="2018-11-25T05:29:16+00:00"> 25 November 2018 at 05:29                                </time> </a></div><div></div><div></div></div></div><div class="comment-content"><p>I wonder what value of radius of the spherical approximation, between shorter and longer radius of ellipsoid, would minimize errors&#8230;</p></div><div class="reply"></div> </article></li><li id="comment-955367" class="comment byuser comment-author-john bypostauthor odd alt thread-odd thread-alt depth-1"> <article id="div-comment-955367" class="comment-body"><div class="comment-author vcard"><div class="comment-author-image"></div><div class="comment-author-name"><div> <cite class="fn">John</cite></div><div> <a href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/#comment-955367"> <time datetime="2018-11-25T21:09:01+00:00"> 25 November 2018 at 21:09                                </time> </a></div><div></div><div></div></div></div><div class="comment-content"><p>Dr. Drang: I revised the post to use mean radius.</p><p>Jakub: I don&#8217;t know exactly, but I bet the optimal radius is not far from the mean radius. Maybe closer to the equatorial radius because that&#8217;s the radius in two orthogonal directions while the polar radius is the radius in one direction. Maybe the geometric mean, cube root of equatorial^2 * polar.</p></div><div class="reply"></div> </article></li></ol><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/2018/11/24/spheroid-distance/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://www.johndcook.com/blog/wp-comments-post.php" method="post" id="commentform" class="comment-form"><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label><textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p style="clear: both;" class="subscribe-to-comments"> <input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" /> <label for="subscribe">Notify me of followup comments via e-mail</label></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p><p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p><p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='37220' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="34af23fcee" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="228"/></p></form></div></div></div></div><div id="secondary" class="widget-area" role="complementary"> <aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://www.johndcook.com/blog/"> <label> <span class="screen-reader-text">Search for:</span> <input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" title="Search for:"> </label> <input type="submit" class="search-submit" value="Search"></form> </aside><aside id="text-2" class="widget widget_text"><div class="textwidget"><div style="height: 250px; width: 250px;"><a href="//www.johndcook.com"><img style="height: auto; width: 100%; -webkit-border-radius: 50%; -moz-border-radius: 50%; -ms-border-radius: 50%; -o-border-radius: 50%; border-radius: 50%;" src="//www.johndcook.com/jdc_20170630.jpg" alt="John D. Cook" width="250" height="250" /></a></div><p style="margin-bottom: 1.5em; margin-top: 1.5em;"><strong>John D. Cook, PhD, President</strong></p><p>My colleagues and I have decades of consulting experience helping companies solve complex problems involving data privacy, math, statistics, and computing.</p><p>Let&#8217;s talk. We look forward to exploring the opportunity to help your company too.</p><div role="form" class="wpcf7" id="wpcf7-f28049-o1" lang="en-US" dir="ltr"><div class="screen-reader-response"></div><form action="/blog/2018/11/24/spheroid-distance/#wpcf7-f28049-o1" method="post" class="wpcf7-form" novalidate="novalidate"><div style="display: none;"> <input type="hidden" name="_wpcf7" value="28049" /><br /> <input type="hidden" name="_wpcf7_version" value="5.0.5" /><br /> <input type="hidden" name="_wpcf7_locale" value="en_US" /><br /> <input type="hidden" name="_wpcf7_unit_tag" value="wpcf7-f28049-o1" /><br /> <input type="hidden" name="_wpcf7_container_post" value="0" /></div><p><span class="wpcf7-form-control-wrap your-email"><input type="email" name="your-email" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-email wpcf7-validates-as-required wpcf7-validates-as-email" aria-required="true" aria-invalid="false" placeholder="Email address" /></span><br /> <span class="wpcf7-form-control-wrap your-message"><textarea name="your-message" cols="40" rows="4" class="wpcf7-form-control wpcf7-textarea wpcf7-validates-as-required" aria-required="true" aria-invalid="false" placeholder="Your company&#039;s project ..."></textarea></span><br /> <input type="submit" value="Send" class="wpcf7-form-control wpcf7-submit btn btn-primary" /></p><div class="wpcf7-response-output wpcf7-display-none"></div></form></div><p>&nbsp;</p></div> </aside><aside id="latest-posts-widget-2" class="widget latest-posts-widget"><h1 class="widget-title">Latest Posts</h1><ul><li class="recent-post-thumb-item"> <a class="post-title" href="https://www.johndcook.com/blog/2018/11/26/all-possible-scales/" rel="bookmark" title="Permanent link to All possible scales">All possible scales</a></li><li class="recent-post-thumb-item"> <a class="post-title" href="https://www.johndcook.com/blog/2018/11/24/spheroid-distance/" rel="bookmark" title="Permanent link to Ellipsoid distance on Earth">Ellipsoid distance on Earth</a></li><li class="recent-post-thumb-item"> <a class="post-title" href="https://www.johndcook.com/blog/2018/11/24/sequence-alignment/" rel="bookmark" title="Permanent link to Sequence alignment">Sequence alignment</a></li><li class="recent-post-thumb-item"> <a class="post-title" href="https://www.johndcook.com/blog/2018/11/21/levenshtein-distance/" rel="bookmark" title="Permanent link to Levenshtein distance from Finnegans Wake to Return of the Jedi">Levenshtein distance from Finnegans Wake to Return of the Jedi</a></li><li class="recent-post-thumb-item"> <a class="post-title" href="https://www.johndcook.com/blog/2018/11/21/renyi-differential-privacy/" rel="bookmark" title="Permanent link to Rényi Differential Privacy">Rényi Differential Privacy</a></li></ul> </aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1><form action="https://www.johndcook.com/blog" method="get"><label class="screen-reader-text" for="cat">Categories</label><select name='cat' id='cat' class='postform' ><option value='-1'>Select Category</option><option class="level-0" value="3">Business</option><option class="level-0" value="4">Clinical trials</option><option class="level-0" value="5">Computing</option><option class="level-0" value="6">Creativity</option><option class="level-0" value="7">Graphics</option><option class="level-0" value="157">Machine learning</option><option class="level-0" value="9">Math</option><option class="level-0" value="10">Music</option><option class="level-0" value="13">PowerShell</option><option class="level-0" value="14">Python</option><option class="level-0" value="15">Science</option><option class="level-0" value="16">Software development</option><option class="level-0" value="17">Statistics</option><option class="level-0" value="18">Typography</option><option class="level-0" value="1">Uncategorized</option> </select></form> <script type='text/javascript'>(function(){var dropdown=document.getElementById("cat");function onCatChange(){if(dropdown.options[dropdown.selectedIndex].value>0){dropdown.parentNode.submit();}}
dropdown.onchange=onCatChange;})();</script> </aside><aside id="text-4" class="widget widget_text"><div class="textwidget"><table><tbody><tr><td><a href="https://feedburner.google.com/fb/a/mailverify?uri=TheEndeavour&amp;loc=en_US"><img src="//www.johndcook.com/contact_email.svg" alt="Subscribe to blog by email" width="32" height="32" /></a></td><td style="vertical-align: bottom;"><a href="https://feedburner.google.com/fb/a/mailverify?uri=TheEndeavour&amp;loc=en_US">Subscribe via email</a></td></tr><tr><td><a href="//www.johndcook.com/blog/feed" type="application/rss+xml"><img src="//www.johndcook.com/contact_rss.svg" alt="RSS icon" width="32" height="32" /></a></td><td style="vertical-align: bottom;"><a href="//www.johndcook.com/blog/feed">Subscribe via RSS</a></td></tr><tr><td><a href="//www.johndcook.com/blog/newsletter/" type="application/rss+xml"><img src="//www.johndcook.com/newsletter.svg" alt="Newsletter icon" width="32" height="32" /></a></td><td style="vertical-align: bottom;"><a href="//www.johndcook.com/blog/newsletter">Monthly newsletter</a></td></tr></tbody></table></div> </aside></div></div></div></div><div class="footer-client-logos-container"><div class="responsive-container"><ul class="footer-client-logos"></ul></div></div> <footer id="colophon" class="site-footer" role="contentinfo"><div class="responsive-container"><div class="site-info"><h3><a href="https://www.johndcook.com/blog/">John D. Cook</a></h3><p>&copy; All rights reserved.</p><div class="footer-search"><form role="search" method="get" class="search-form" action="https://www.johndcook.com/blog/"> <label> <span class="screen-reader-text">Search for:</span> <input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" title="Search for:"> </label> <input type="submit" class="search-submit" value="Search"></form></div></div><div class="footer-widget-three"></div><div class="footer-widget-three"></div><div class="footer-widget-three"></div></div> </footer></div></div></div></div></div> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer="defer" type="text/javascript"></script> <script type='text/javascript'>var wpcf7={"apiSettings":{"root":"https:\/\/www.johndcook.com\/blog\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};</script> <script type='text/javascript'>try{jQuery.noConflict();}catch(e){};</script> <script src="https://www.johndcook.com/blog/wp-content/plugins/contact-form-7/includes/js/scripts.js" defer="defer" type="text/javascript"></script> <script src="https://www.johndcook.com/blog/wp-content/plugins/pc-google-analytics/assets/js/frontend.min.js" defer="defer" type="text/javascript"></script> <script src="https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/js/tinynav.min.js" defer="defer" type="text/javascript"></script> <script src="https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/js/general.js" defer="defer" type="text/javascript"></script> <script src="https://www.johndcook.com/blog/wp-content/themes/ThemeAlley.Business.Pro/js/skip-link-focus-fix.js" defer="defer" type="text/javascript"></script> <script src="https://www.johndcook.com/blog/wp-includes/js/wp-embed.min.js" defer="defer" type="text/javascript"></script> <script async="async" src="https://www.johndcook.com/blog/wp-content/plugins/akismet/_inc/form.js" defer="defer" type="text/javascript"></script> <script type="text/javascript">(function($){$(".nav-previous, .nav-next").click(function(){window.location=$(this).find("a:first").attr("href");return false;});$(".nav-previous, .nav-next").hover(function(){window.status=jQuery(this).find("a:first").attr("href");},function(){window.status="";});})(jQuery);</script> </body></html>